FROM backend:latest

# Set environment variable to indicate we're in test mode
ENV ENVIRONMENT=test
ENV TEST_DATABASE_URL=postgresql://postgres:postgres@postgres:5432/test_app_db

# Install testing dependencies
RUN pip install --no-cache-dir pytest pytest-cov httpx

# Make sure the uploads directory exists for file tests
RUN mkdir -p uploads

# Set the working directory
WORKDIR /app

# Copy test files
COPY ./tests /app/tests

# Command to run tests
CMD ["pytest", "-v"]
